{"https://www.freecodecamp.org/news/author/olivier/":{"https://www.freecodecamp.org//news/gcp-cloudiotcore-esp32-mongooseos-1st-5c88d8134ac7/":{"html":"<!DOCTYPE html>\n<html lang=\"en\">\n    <head>\n        <meta charset=\"utf-8\">\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n        \n        \n            <title>How to check the weather using GCP-Cloud IoT Core with ESP32 and Mongoose OS</title>\n        \n        <meta name=\"HandheldFriendly\" content=\"True\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin=\"\">\n        \n            <link rel=\"preload\" as=\"style\" onload=\"this.onload=null;this.rel='stylesheet'\" href=\"https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,400&family=Roboto+Mono:wght@400;700&display=swap\">\n        \n\n        \n        \n    <link rel=\"preload\" as=\"style\" onload=\"this.onload=null;this.rel='stylesheet'\" href=\"https://cdn.freecodecamp.org/news-assets/prism/1.29.0/themes/prism.min.css\">\n<noscript>\n  <link rel=\"stylesheet\" href=\"https://cdn.freecodecamp.org/news-assets/prism/1.29.0/themes/prism.min.css\">\n</noscript>\n<link rel=\"preload\" as=\"style\" onload=\"this.onload=null;this.rel='stylesheet'\" href=\"https://cdn.freecodecamp.org/news-assets/prism/1.29.0/plugins/unescaped-markup/prism-unescaped-markup.min.css\">\n<noscript>\n  <link rel=\"stylesheet\" href=\"https://cdn.freecodecamp.org/news-assets/prism/1.29.0/plugins/unescaped-markup/prism-unescaped-markup.min.css\">\n</noscript>\n\n<script defer=\"\" src=\"https://cdn.freecodecamp.org/news-assets/prism/1.29.0/components/prism-core.min.js\"></script>\n<script defer=\"\" src=\"https://cdn.freecodecamp.org/news-assets/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js\"></script>\n\n\n\n        \n        <link rel=\"preload\" as=\"style\" onload=\"this.onload=null;this.rel='stylesheet'\" href=\"/news/assets/css/global-26e2f3cde9.css\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"/news/assets/css/screen-926fddfac2.css\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"/news/assets/css/search-bar-124f5f949c.css\">\n\n        \n        <script defer=\"\" src=\"https://cdn.freecodecamp.org/news-assets/algolia/algoliasearch-3-33-0/algoliasearch.min.js\"></script>\n        <script defer=\"\" src=\"https://cdn.freecodecamp.org/news-assets/algolia/autocomplete-0-36-0/autocomplete.min.js\"></script>\n\n        \n        <script defer=\"\" src=\"https://cdn.freecodecamp.org/news-assets/dayjs/1.10.4/dayjs.min.js\"></script>\n        <script defer=\"\" src=\"https://cdn.freecodecamp.org/news-assets/dayjs/1.10.4/localizedFormat.min.js\"></script>\n        <script defer=\"\" src=\"https://cdn.freecodecamp.org/news-assets/dayjs/1.10.4/relativeTime.min.js\"></script>\n\n        \n        \n            <script defer=\"\" src=\"https://cdn.freecodecamp.org/news-assets/dayjs/1.10.4/locale/en.min.js\"></script>\n        \n\n        \n        <script>let client,index;document.addEventListener(\"DOMContentLoaded\",(()=>{client=algoliasearch(\"QMJYL5WYTI\",\"89770b24481654192d7a5c402c6ad9a0\"),index=client.initIndex(\"news\")})),document.addEventListener(\"DOMContentLoaded\",(()=>{const e=window.screen.width,t=window.screen.height,n=e>=767&&t>=768?8:5,o=document.getElementById(\"search-form\"),s=document.getElementById(\"search-input\"),a=document.getElementById(\"dropdown-container\");let i,d,c;s.addEventListener(\"input\",(e=>{i=e.target.value})),o.addEventListener(\"submit\",(e=>{e.preventDefault(),function(){if(d=document.getElementsByClassName(\"aa-cursor\")[0],d&&i){const e=d.querySelector(\"a\").href;window.location.assign(e)}else!d&&i&&c&&window.location.assign(`https://www.freecodecamp.org/news/search?query=${i}`)}()}));const l=autocomplete(\"#search-input\",{hint:!1,keyboardShortcuts:[\"s\",191],openOnFocus:!0,appendTo:a,debug:!0},[{source:autocomplete.sources.hits(index,{hitsPerPage:n}),debounce:250,templates:{suggestion:e=>(c=!0,`\\n            <a href=\"${e.url}\">\\n              <div class=\"algolia-result\">\\n                <span>${e._highlightResult.title.value}</span>\\n              </div>\\n            </a>\\n          `),empty:()=>(c=!1,'\\n            <div class=\"aa-suggestion footer-suggestion no-hits-footer\">\\n              <div class=\"algolia-result\">\\n                <span>\\n                  No tutorials found\\n                </span>\\n              </div>\\n            </div>\\n          '),footer:e=>{if(!e.isEmpty)return`\\n              <div class=\"aa-suggestion footer-suggestion\">\\n                <a id=\"algolia-footer-selector\" href=\"https://www.freecodecamp.org/news/search?query=${i}\">\\n                  <div class=\"algolia-result algolia-footer\">\\n                    See all results for ${i}\\n                  </div>\\n                </a>\\n              </div>\\n            `}}}]).on(\"autocomplete:selected\",((e,t,n,o)=>{d=t?t.url:`https://www.freecodecamp.org/news/search?query=${i}`,\"click\"!==o.selectionMethod&&\"tabKey\"!==o.selectionMethod&&c&&window.location.assign(d)}));document.addEventListener(\"click\",(e=>{e.target!==s&&l.autocomplete.close()}))})),document.addEventListener(\"DOMContentLoaded\",(()=>{dayjs.extend(dayjs_plugin_localizedFormat),dayjs.extend(dayjs_plugin_relativeTime),dayjs.locale(\"en\")}));const isAuthenticated=document.cookie.split(\";\").some((e=>e.trim().startsWith(\"jwt_access_token=\"))),isDonor=document.cookie.split(\";\").some((e=>e.trim().startsWith(\"isDonor=true\")));</script>\n\n        \n        \n    \n        \n            <script data-ad-client=\"ca-pub-9482786369113753\" src=\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\" crossorigin=\"anonymous\" async=\"\"></script>\n        \n    \n\n\n        \n        \n    \n        \n    \n        \n    \n        \n    \n        \n    \n        \n    \n\n\n        \n        \n        \n\n        \n        \n\n        <link rel=\"icon\" href=\"https://cdn.freecodecamp.org/universal/favicons/favicon.ico\" type=\"image/png\">\n        \n        \n            <link rel=\"canonical\" href=\"https://www.freecodecamp.org/news/gcp-cloudiotcore-esp32-mongooseos-1st-5c88d8134ac7/\">\n        \n        <meta name=\"referrer\" content=\"no-referrer-when-downgrade\">\n\n        \n\n        \n    <meta name=\"description\" content=\"This post on freecodecamp.org is not maintained. The most up to date version is on Medium:  https://medium.com/free-code-camp/gcp-cloudiotcore-esp32-mongooseos-1st-5c88d8134ac7 This post is a step-by-step tutorial for newbies to Google Cloud Platform-Cloud IoT Core. The devices are ESP32 Wifi chips running Mongoose OS. To go through his tutorial, the concepts and then\">\n\n    \n    <meta property=\"og:site_name\" content=\"freeCodeCamp.org\">\n    <meta property=\"og:type\" content=\"article\">\n    <meta property=\"og:title\" content=\"How to check the weather using GCP-Cloud IoT Core with ESP32 and Mongoose OS\">\n    \n        <meta property=\"og:description\" content=\"This post on freecodecamp.org is not maintained. The most up to date version is on Medium:  https://medium.com/free-code-camp/gcp-cloudiotcore-esp32-mongooseos-1st-5c88d8134ac7 This post is a step-by-step tutorial for newbies to Google Cloud Platform-Cloud IoT Core. The devices are ESP32 Wifi chips running Mongoose OS. To go through his tutorial, the concepts and then\">\n    \n    <meta property=\"og:url\" content=\"https://www.freecodecamp.org/news/gcp-cloudiotcore-esp32-mongooseos-1st-5c88d8134ac7/\">\n    <meta property=\"og:image\" content=\"https://cdn-media-1.freecodecamp.org/images/1*GGNvAgxLJXeagpiyQnlHvQ.jpeg\">\n    <meta property=\"article:published_time\" content=\"2019-02-28T22:07:21.000Z\">\n    <meta property=\"article:modified_time\" content=\"2019-09-26T11:06:02.000Z\">\n    \n        <meta property=\"article:tag\" content=\"IoT\">\n    \n        <meta property=\"article:tag\" content=\"Google Cloud\">\n    \n        <meta property=\"article:tag\" content=\"Firebase\">\n    \n        <meta property=\"article:tag\" content=\"Tech\">\n    \n        <meta property=\"article:tag\" content=\"Programming\">\n    \n    <meta property=\"article:publisher\" content=\"https://www.facebook.com/freecodecamp\">\n    \n\n    \n    <meta name=\"twitter:card\" content=\"summary_large_image\">\n    <meta name=\"twitter:title\" content=\"How to check the weather using GCP-Cloud IoT Core with ESP32 and Mongoose OS\">\n    \n        <meta name=\"twitter:description\" content=\"This post on freecodecamp.org is not maintained. The most up to date version is on Medium:  https://medium.com/free-code-camp/gcp-cloudiotcore-esp32-mongooseos-1st-5c88d8134ac7 This post is a step-by-step tutorial for newbies to Google Cloud Platform-Cloud IoT Core. The devices are ESP32 Wifi chips running Mongoose OS. To go through his tutorial, the concepts and then\">\n    \n    <meta name=\"twitter:url\" content=\"https://www.freecodecamp.org/news/gcp-cloudiotcore-esp32-mongooseos-1st-5c88d8134ac7/\">\n    <meta name=\"twitter:image\" content=\"https://cdn-media-1.freecodecamp.org/images/1*GGNvAgxLJXeagpiyQnlHvQ.jpeg\">\n    <meta name=\"twitter:label1\" content=\"Written by\">\n    <meta name=\"twitter:data1\" content=\"Olivier LOURME\">\n    <meta name=\"twitter:label2\" content=\"Filed under\">\n    <meta name=\"twitter:data2\" content=\"IoT, Google Cloud, Firebase, Tech, Programming\">\n    <meta name=\"twitter:site\" content=\"@freecodecamp\">\n    \n\n    <meta property=\"og:image:width\" content=\"800\">\n    <meta property=\"og:image:height\" content=\"400\">\n\n\n        \n    <script type=\"application/ld+json\">{\n\t\"@context\": \"https://schema.org\",\n\t\"@type\": \"Article\",\n\t\"publisher\": {\n\t\t\"@type\": \"Organization\",\n\t\t\"name\": \"freeCodeCamp.org\",\n\t\t\"url\": \"https://www.freecodecamp.org/news/\",\n\t\t\"logo\": {\n\t\t\t\"@type\": \"ImageObject\",\n\t\t\t\"url\": \"https://cdn.freecodecamp.org/platform/universal/fcc_primary.svg\",\n\t\t\t\"width\": 2100,\n\t\t\t\"height\": 240\n\t\t}\n\t},\n\t\"image\": {\n\t\t\"@type\": \"ImageObject\",\n\t\t\"url\": \"https://cdn-media-1.freecodecamp.org/images/1*GGNvAgxLJXeagpiyQnlHvQ.jpeg\",\n\t\t\"width\": 800,\n\t\t\"height\": 400\n\t},\n\t\"url\": \"https://www.freecodecamp.org/news/gcp-cloudiotcore-esp32-mongooseos-1st-5c88d8134ac7/\",\n\t\"mainEntityOfPage\": {\n\t\t\"@type\": \"WebPage\",\n\t\t\"@id\": \"https://www.freecodecamp.org/news/\"\n\t},\n\t\"datePublished\": \"2019-02-28T22:07:21.000Z\",\n\t\"dateModified\": \"2019-09-26T11:06:02.000Z\",\n\t\"keywords\": \"IoT, Google Cloud, Firebase, Tech, Programming\",\n\t\"description\": \"This post on freecodecamp.org is not maintained. The most up to date version is\\non Medium: \\nhttps://medium.com/free-code-camp/gcp-cloudiotcore-esp32-mongooseos-1st-5c88d8134ac7\\n\\nThis post is a step-by-step tutorial for newbies to Google Cloud Platform-Cloud\\nIoT Core. The devices are ESP32 Wifi chips running Mongoose OS. To go through\\nhis tutorial, the concepts and then the setup of a simple IoT system measuring\\nweather data are described.\\n\\nLive demo is here: https://hello-cloud-iot-core.firebase\",\n\t\"headline\": \"How to check the weather using GCP-Cloud IoT Core with ESP32 and Mongoose OS\",\n\t\"author\": {\n\t\t\"@type\": \"Person\",\n\t\t\"name\": \"Olivier LOURME\",\n\t\t\"url\": \"https://www.freecodecamp.org/news/author/olivier/\",\n\t\t\"sameAs\": []\n\t}\n}</script>\n\n\n        <meta name=\"generator\" content=\"Eleventy\">\n        <link rel=\"alternate\" type=\"application/rss+xml\" title=\"freeCodeCamp.org\" href=\"https://www.freecodecamp.org/news/rss/\">\n\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\">\n\n<!-- dataLayer setup -->\n<script>\nwindow.dataLayer = window.dataLayer || [];\n</script>\n<!-- End dataLayer setup -->\n\n<!-- Google Tag Manager -->\n<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':\nnew Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],\nj=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=\n'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);\n})(window,document,'script','dataLayer','GTM-5D6RKKP');</script>\n<!-- End Google Tag Manager -->\n\n\n<meta name=\"google-site-verification\" content=\"b4tITLzEeeZGEpvD4mGNf3khKM4fvqejQaz9SYBQP8E\">\n\n        \n        \n\n        \n  <meta name=\"x-fcc-source\" data-test-label=\"x-fcc-source\" content=\"Ghost\">\n\n    </head>\n\n    \n        <body class=\"home-template\">\n    \n        <div class=\"site-wrapper\">\n            <nav class=\"site-nav nav-padding\">\n    <div class=\"site-nav-left\">\n        \n<form id=\"search-form\" data-test-label=\"search-bar\">\n    <div role=\"search\" class=\"searchbox__wrapper\">\n        <label class=\"fcc_sr_only\" for=\"search-input\">\n            Search\n        </label>\n        <input type=\"search\" placeholder=\"\n    Search 11,200+ tutorials\n\" id=\"search-input\">\n        <button type=\"submit\" class=\"ais-SearchBox-submit\">\n            <svg class=\"ais-SearchBox-submitIcon\" xmlns=\"https://www.w3.org/2000/svg\" width=\"10\" height=\"10\" viewBox=\"0 0 40 40\">\n    <path d=\"M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z\"></path>\n</svg>\n\n            <span class=\"fcc_sr_only\">Submit your search query</span>\n        </button>\n        <div id=\"dropdown-container\"></div>\n    </div>\n</form>\n\n    </div>\n    <div class=\"site-nav-middle\">\n        <a class=\"site-nav-logo\" href=\"https://www.freecodecamp.org/news/\" data-test-label=\"site-nav-logo\"><img src=\"https://cdn.freecodecamp.org/platform/universal/fcc_primary.svg\" alt=\"freeCodeCamp.org\"></a>\n    </div>\n    <div class=\"site-nav-right\">\n        <div class=\"nav-group\">\n            <a class=\"nav-forum\" id=\"nav-forum\" rel=\"noopener noreferrer\" href=\"https://forum.freecodecamp.org/\" target=\"_blank\" data-test-label=\"forum-button\">Forum</a>\n            <a class=\"toggle-button-nav\" id=\"nav-donate\" rel=\"noopener noreferrer\" href=\"https://www.freecodecamp.org/donate/\" target=\"_blank\" data-test-label=\"donate-button\">Donate</a>\n        </div>\n    </div>\n</nav>\n\n\n            \n            <a class=\"banner\" id=\"banner\" data-test-label=\"banner\" rel=\"noopener noreferrer\" target=\"_blank\">\n    <p id=\"banner-text\"></p>\n</a>\n\n\n    \n    <script>document.addEventListener(\"DOMContentLoaded\",(()=>{const e=document.getElementById(\"banner\"),t=document.getElementById(\"banner-text\");isAuthenticated?(t.innerHTML=\"Support our charity and our mission. <span>Donate to freeCodeCamp.org</span>.\",e.href=\"https://www.freecodecamp.org/donate\",e.setAttribute(\"text-variation\",\"authenticated\")):isDonor?(t.innerHTML=\"Thank you for supporting freeCodeCamp through <span>your donations</span>.\",e.href=\"https://www.freecodecamp.org/news/how-to-donate-to-free-code-camp/\",e.setAttribute(\"text-variation\",\"donor\")):(t.innerHTML=\"Learn to code — <span>free 3,000-hour curriculum</span>\",e.href=\"https://www.freecodecamp.org/\",e.setAttribute(\"text-variation\",\"default\"))}));</script>\n\n\n            <div id=\"error-message\"></div>\n\n            \n    <main id=\"site-main\" class=\"post-template site-main outer\">\n        <div class=\"inner ad-layout\">\n            <article class=\"post-full post\">\n                <header class=\"post-full-header\">\n                    <section class=\"post-full-meta\">\n                        <time class=\"post-full-meta-date\" data-test-label=\"post-full-meta-date\" datetime=\"Thu Feb 28 2019 22:07:21 GMT+0000 (Coordinated Universal Time)\">\n                            February 28, 2019\n                        </time>\n                        \n                            <span class=\"date-divider\">/</span>\n                            <a dir=\"ltr\" href=\"/news/tag/iot/\">\n                                #IoT\n                            </a>\n                        \n                    </section>\n                    <h1 class=\"post-full-title\" data-test-label=\"post-full-title\">How to check the weather using GCP-Cloud IoT Core with ESP32 and Mongoose OS</h1>\n                </header>\n                <div class=\"post-full-author-header\" data-test-label=\"author-header-no-bio\">\n                    \n                        \n                            \n    \n    \n    \n\n    <section class=\"author-card\" data-test-label=\"author-card\">\n        \n            <span class=\"avatar-wrapper\">\n                \n                <svg role=\"img\" style=\"pointer-events: none;\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" data-test-label=\"avatar\"><title>Olivier LOURME</title><g fill=\"none\" fill-rule=\"evenodd\"><path d=\"M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z\" fill=\"#FFF\"></path></g></svg>\n\n            </span>\n        \n\n        <section class=\"author-card-content author-card-content-no-bio\">\n            <span class=\"author-card-name\">\n                <a href=\"/news/author/olivier/\" data-test-label=\"profile-link\">\n                    \n                        Olivier LOURME\n                    \n                </a>\n            </span>\n            \n        </section>\n    </section>\n\n                        \n                    \n                </div>\n                <figure class=\"post-full-image\">\n                    \n    <picture>\n      <source media=\"(max-width: 700px)\" sizes=\"1px\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 1w\">\n      <source media=\"(min-width: 701px)\" sizes=\"(max-width: 800px) 400px, (max-width: 1170px) 700px, 1400px\" srcset=\"https://cdn-media-1.freecodecamp.org/images/1*GGNvAgxLJXeagpiyQnlHvQ.jpeg\">\n      <img onerror=\"this.style.display='none'\" src=\"https://cdn-media-1.freecodecamp.org/images/1*GGNvAgxLJXeagpiyQnlHvQ.jpeg\" alt=\"How to check the weather using GCP-Cloud IoT Core with ESP32 and Mongoose OS\" ,=\"\" width=\"800\" height=\"400\" data-test-label=\"feature-image\">\n    </picture>\n  \n                </figure>\n                <section class=\"post-full-content\">\n                    <div class=\"post-and-sidebar\">\n                        <section class=\"post-content \" data-test-label=\"post-content\">\n                            \n<p>This post on freecodecamp.org is not maintained. The most up to date version is on Medium: <a href=\"https://medium.com/free-code-camp/gcp-cloudiotcore-esp32-mongooseos-1st-5c88d8134ac7\">https://medium.com/free-code-camp/gcp-cloudiotcore-esp32-mongooseos-1st-5c88d8134ac7</a></p><p>This post is a step-by-step tutorial for newbies to <strong>Google Cloud Platform-Cloud IoT Core</strong>. The devices are <strong>ESP32 Wifi chips</strong> running <strong>Mongoose OS</strong>. To go through his tutorial, the concepts and then the setup of a simple <strong>IoT system</strong> <strong>measuring weather data</strong> are described.</p><p><strong>Live demo is here:</strong> <a href=\"https://hello-cloud-iot-core.firebaseapp.com/\" rel=\"noopener\">https://hello-cloud-iot-core.firebaseapp.com/</a></p><p><strong>GitHub for last section<em> </em></strong><em>(Logging, storing and visualizing weather data with Firebase) <strong>is here:</strong></em><strong> </strong><a href=\"https://github.com/olivierlourme/iot-store-display\" rel=\"noopener\">https://github.com/olivierlourme/iot-store-display</a></p><p><strong>This post is completed by a second one:</strong> see <a href=\"https://medium.com/@o.lourme/gcp-cloudiotcore-esp32-mongooseos-2nd-config-state-encrypt-7c5e937e5be9\" rel=\"noopener\">here</a>.</p><h3 id=\"introduction\">Introduction</h3><h4 id=\"1-history\">1) History</h4><p>In a previous 3-post series [<a href=\"https://medium.com/@o.lourme/our-iot-journey-through-esp8266-firebase-angular-and-plotly-js-part-1-a07db495ac5f\" rel=\"noopener\">link</a>, <a href=\"https://medium.com/@o.lourme/our-iot-journey-through-esp8266-firebase-angular-and-plotly-js-part-2-14b0609d3f5e\" rel=\"noopener\">link</a>, <a href=\"https://medium.com/@o.lourme/our-iot-journey-through-esp8266-firebase-angular-and-plotly-js-part-3-644048e90ca4\" rel=\"noopener\">link</a>], we used an <strong>ESP8266 Wifi chip </strong>to regularly measure luminosity and feed a database with the obtained data. The data set was ultimately lively plotted to a web app (see live plot here: [<a href=\"https://esp8266-rocks.firebaseapp.com/\" rel=\"noopener\">link</a>]). We massively used <strong>Firebase products </strong>(Realtime Database, Cloud Functions, SDK and Hosting) to meet our goals.</p><p>This project works fine, it draws very little power and we enjoyed developing it — but:</p><ul><li><strong>This project was okay to handle just a few connected sensors</strong>. Setting up a set of a hundred sensors would require a lot of (rigorous) manual intervention and monitoring them would be challenging as well. Indeed, there is no central place where we can manage our system.</li><li><strong>Arduino IDE</strong> and <strong>Arduino core for ESP8266</strong> were great for discovering ESP8266 but they are <strong>quickly insufficient</strong>: The IDE file management is really basic, there is only one program in the chip, and <strong>there is no Operating System</strong> <strong>providing useful APIs for IoT</strong>.</li><li><strong>FirebaseArduino</strong> <strong>library</strong>, allowing an ESP8266 to push data to a Firebase Realtime Database, <strong>was experimental</strong>. Some features like authentication should be improved. For now, the “secret” type authentication we used gives ESP8266 admin rights over the whole database!</li><li>Eventually, <strong>ESP8266 SPI flash memory was not designed to be encrypted</strong>. In our first post [<a href=\"https://medium.com/@o.lourme/our-iot-journey-through-esp8266-firebase-angular-and-plotly-js-part-1-a07db495ac5f\" rel=\"noopener\">link</a>], we showed how easy it was to recover a Wifi password when reading this memory.</li></ul><blockquote>In a word, this past project couldn’t be used in an industrial context. It was more a prototype for a Proof of Concept. We learnt a lot with it but today <strong>we’d like to develop a professional and fully secured solution capable of managing in a simple way a lot of connected sensors</strong>.</blockquote><p>This is why we decided to:</p><ul><li><strong>investigate Google Cloud Platform-Cloud IoT Core</strong> [<a href=\"https://cloud.google.com/iot-core/\" rel=\"noopener\">link</a>]<strong> </strong>to manage our system : devices setup, provision, authentication and monitoring;</li><li><strong>move from ESP8266 to ESP32</strong>, which offers memory encryption;</li><li><strong>run Mongoose OS</strong> [<a href=\"https://mongoose-os.com/\" rel=\"noopener\">link</a>] in our ESP32s. This OS accepts programs written in Javascript(JS) and provides a lot of APIs to deal with time, MQTT protocol, sensors, provisioning, etc. It is easy to interface with the main IoT platforms, including Google Cloud Platform-Cloud IoT Core.</li></ul><h4 id=\"2-a-word-about-esp32-wifi-chip\"><strong>2) A word about ESP32 Wifi chip</strong></h4><p>ESP32 Wifi chip is a successor of the famous ESP8266 we described here: [<a href=\"https://medium.com/@o.lourme/our-iot-journey-through-esp8266-firebase-angular-and-plotly-js-part-1-a07db495ac5f\" rel=\"noopener\">link</a>]. Compared to it, every feature is enhanced (speed up to 240 MHz, two cores, 520 kiB RAM, number of GPIOs, variety of peripherals, etc.) and there are some new ones (Bluetooth: legacy/BLE, <strong>4 MiB-flash memory encryption capability</strong>, <strong>cryptographic hardware acceleration</strong>: AES, SHA-2, RSA, ECC, RNG). There are a lot of resources on the web concerning ESP32. The following one deals with the <strong>ESP32 DEVKIT V1 development board </strong>that we will use and gives its pinout: [<a href=\"https://randomnerdtutorials.com/esp32-pinout-reference-gpios/\" rel=\"noopener\">link</a>].</p><p>There is also this extensive resource concerning the wide variety of ESP32 chips and development kits : <a href=\"http://esp32.net/\" rel=\"noopener\">http://esp32.net/</a> . On their home page, searching for “ESP32 DevKit” or “GeekCreit” leads to a link to the <a href=\"https://github.com/SmartArduino/ESP/blob/master/SchematicsforESP32.pdf\" rel=\"noopener\">schematic</a> of our ESP32 DEVKIT V1. This development board embeds an official Espressif ESP32-WROOM-32 chip and costs about 6€ at Banggood.</p><h3 id=\"basic-iot-concepts-explained-through-our-use-case\">Basic IoT concepts explained through our use case</h3><p>So, what will be our playground for test all these new tools?</p><blockquote>To illustrate IoT concepts through Cloud IoT Core, we chose to build <strong>a weather station</strong> <strong>reporting humidity and temperature from different places</strong>.</blockquote><p>For simplicity we’ll handle only 2 places: inside our house (“indoor”) and outside our house (“outdoor”). It’s up to you to deal with many more places.</p><h4 id=\"1-project-hardware-esp32-dht22\">1) Project hardware : ESP32 &amp; DHT22</h4><p>At each of theses places, we’ll install a connected sensor (<strong>“a device”</strong>) constituted by a <strong>DHT22</strong> <strong>humidity/temperature sensor </strong>(description: [<a href=\"https://learn.adafruit.com/dht\" rel=\"noopener\">link</a>], datasheet: [<a href=\"https://cdn-shop.adafruit.com/datasheets/Digital+humidity+and+temperature+sensor+AM2302.pdf\" rel=\"noopener\">link</a>], 4€ at Banggood)<strong> </strong>connected to an <strong>ESP32 DEVKIT V1</strong> development board. DHT22 observes a kind of “1-Wire” protocol. Each ESP32 will house <strong>Mongoose OS</strong> for operating system. Its installation on an ESP32, a Hello, World! and a test with a DHT22 are given in the following section below.</p><p>Just below are given DHT22 specifications. Afterwards, we think the accuracy figures are a bit optimistic but that’s not our concern today.</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*WIxEy4NLdDr_2SVhcjmv0g.png\" class=\"kg-image\" alt=\"1*WIxEy4NLdDr_2SVhcjmv0g\" width=\"682\" height=\"287\" loading=\"lazy\"><figcaption>DHT22 sensor characteristics ([<a href=\"https://learn.adafruit.com/dht/overview\" rel=\"noopener\" target=\"_blank\" title=\"\">link</a>])</figcaption></figure><p>We can already build the following assembly twice (one for indoor and one for outdoor). For now, power will come from the USB connector connected to our host machine. In production, power may come from a power bank.</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*tFxxVtWwVH9gFajtrCWQ0w.png\" class=\"kg-image\" alt=\"1*tFxxVtWwVH9gFajtrCWQ0w\" width=\"800\" height=\"508\" loading=\"lazy\"><figcaption>Assembly Diagram — ESP32 DEVKIT V1 and DHT22 sensor constitute a “device”. Pinout is here : [<a href=\"https://randomnerdtutorials.com/esp32-pinout-reference-gpios/\" rel=\"noopener\" target=\"_blank\" title=\"\">link</a>]</figcaption></figure><p>That’s all for hardware! The rest of the project uses <strong>serverless solutions </strong>from Google. We describe them now…</p><h4 id=\"2-project-architecture-cloud-iot-core-firebase\">2) Project architecture : Cloud IoT Core &amp; Firebase</h4><p>All this “Project architecture” section is theoretical, there is no step to perform. Its aim is to introduce vocabulary and notions related to IoT, more specifically when this domain involves Google Cloud solutions.</p><p>Here is the general architecture of our project:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*PttQxTGMbDHCGwzCsWlZvA.png\" class=\"kg-image\" alt=\"1*PttQxTGMbDHCGwzCsWlZvA\" width=\"800\" height=\"348\" loading=\"lazy\"><figcaption>Project architecture</figcaption></figure><p><em>Note: </em>There is no <strong>gateway </strong>between our devices and Cloud IoT Core because they “speak” MQTT.</p><p><em>Note:</em> Devices can also communicate with Cloud IoT Core via its <strong>HTTP bridge</strong>. As it is less performant than the <strong>MQTT bridge</strong> (see a comparison : [<a href=\"https://cloud.google.com/iot/docs/concepts/protocols\" rel=\"noopener\">link</a>]), we will disallow this communication later during registry configuration. Limiting access just to what is necessary is a good practice.</p><p>Let’s explain this architecture in three sections:</p><ul><li>“From Devices to Cloud Pub/Sub” describes the classical Google IoT architecture.</li><li>“From Cloud Pub/Sub to data storage and visualization”, describes the choices we made to exploit data.</li><li>“Additional config and state topics” completes this architecture presentation.</li></ul><p><strong>From Devices to Cloud Pub/Sub</strong></p><ul><li>Cloud IoT Core</li></ul><p><strong>Cloud IoT Core</strong> is the Google Cloud Platform service to which each of our <strong>registered devices </strong>will send temperature/humidity data. When such a data is sent, we say that <strong>the device publishes a telemetry event</strong> (sometimes also called a “telemetry message”).</p><p><em>Note:</em> Pricing is detailed here : [<a href=\"https://cloud.google.com/iot/pricing\" rel=\"noopener\">link</a>]. For small projects with a few devices, there’s little chance you get charged.</p><ul><li><em>MQTT</em></li></ul><p>This publication is done through a <strong>MQTT connection</strong>. MQTT is a publish/subscribe-based message protocol; most of the time it lies over TCP [<a href=\"https://en.wikipedia.org/wiki/MQTT\" rel=\"noopener\">link</a>] (or better: over TLS, itself being over TCP). The telemetry message has to be published by the device (a MQTT client) to the Cloud Iot Core “MQTT bridge” (a MQTT server) in a <strong>MQTT topic</strong> whose name imperatively respects this format:</p><pre><code>/devices/{device-id}/events</code></pre><p><em>Note:</em> Sub-folders in the topic name are possible. We won’t need this feature here but see [<a href=\"https://cloud.google.com/iot/docs/how-tos/mqtt-bridge#publishing_telemetry_events\" rel=\"noopener\">link</a>], as it can sometimes be useful.</p><p><code>{device-id}</code> is unique to each device. In our case, Mongoose OS creates it from the last 3 bytes of the MAC address of the ESP32. For example it could be <code>esp32_ABB3B4</code>.</p><ul><li><em>Quality of Service (QoS)</em></li></ul><p>The MQTT specification describes three <strong>Quality of Service (QoS)</strong> levels, when publishing to a topic ([<a href=\"https://cloud.google.com/iot/docs/how-tos/mqtt-bridge#quality_of_service_qos\" rel=\"noopener\">link</a>]):</p><p>&gt; QoS 0, the message is delivered at most once;</p><p>&gt; QoS 1, the message is delivered at least once;</p><p>&gt; QoS 2, the message is delivered exactly once.</p><p>Cloud IoT Core does not support QoS 2. And QoS 1 is better than QoS 0. So <strong>QoS 1 is the one we will adopt</strong>. Mongoose OS can do that.</p><ul><li><em>Security</em></li></ul><p>Concerning <strong>security</strong>, in our Mongoose OS/Cloud IoT Core context, MQTT communications are made over <strong>TLS </strong>([<a href=\"https://cloud.google.com/iot/docs/how-tos/mqtt-bridge#mqtt_server\" rel=\"noopener\">link</a>]), so (1) the device is assured to be connected to Cloud IoT Core MQTT server (CA’s certificates are stored in Mongoose OS <code>ca.pem</code> file), (2) the data exchange will be private and (3) data integrity will be checked. On the other way, <strong>device authentication </strong>([<a href=\"https://cloud.google.com/iot/docs/how-tos/mqtt-bridge#device_authentication\" rel=\"noopener\">link</a>]) with Cloud IoT Core is performed with a per-device public/private key authentication using <strong>JSON Web Tokens (JWT)</strong>. The device performs the signature part of the JWT with its private key and Cloud IoT Core validates it using the related public key. Mongoose OS tools handles this keys generation and distribution, we’ll see that soon in the section called “Device registration within the Cloud IoT Core project” lying a few paragraphs below. In this section, we’ll see also how to store securely the private key on the device by performing memory encryption (preventing as well reverse engineering).</p><p><em>Note:</em> Beyond JWT device authentication, for additional security, it’s possible to impose TLS from Cloud IoT Core to devices (so each device has also a public key certificate, etc.). It is an option we won’t use but it’s described <a href=\"https://mongoose-os.com/docs/mongoose-os/api/net/mqtt.md\" rel=\"noopener\">here</a> for Mongoose OS side (see “mutual TLS”) and <a href=\"https://cloud.google.com/iot/docs/how-tos/credentials/verifying-credentials\" rel=\"noopener\">here</a> for Cloud Iot Core side. It’s good to know that AWS IoT imposes this mutual TLS, unconditionally ([<a href=\"https://docs.aws.amazon.com/iot/latest/developerguide/iot-security-identity.html\" rel=\"noopener\">link</a>]).</p><ul><li><em>Registry</em></li></ul><p>Devices sharing the same purpose are regrouped within a <strong>registry</strong>.</p><ul><li><em>Cloud Pub/Sub</em></li></ul><p><strong>Telemetry data from all devices belonging to the same registry is then <em>forwarded </em>to a Cloud Pub/Sub topic </strong>(Cloud Pub/Sub is a GCP product [<a href=\"https://cloud.google.com/pubsub/\" rel=\"noopener\">link</a>], not specifically a Cloud IoT Core one). The name of the Cloud Pub/Sub topic follows this pattern:</p><pre><code>projects/id-of-google-cloud-project/topics/name-of-telemetry-topic</code></pre><p>So, if we call our Google Cloud project <code>hello-cloud-iot-core</code>, if we choose <code>weather-telemetry-topic</code> for the name of our Pub/Sub telemetry topic and if finally our registry is called <code>weather-devices-registry</code>, we’ll get sooner or later that kind of view in <strong>Google Cloud Console</strong> :</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*BeVR0exU6l-rXg8LqJvfeQ.jpeg\" class=\"kg-image\" alt=\"1*BeVR0exU6l-rXg8LqJvfeQ\" width=\"800\" height=\"264\" loading=\"lazy\"><figcaption>Project ID, registry ID and telemetry Pub/Sub topic name in Google Cloud Console</figcaption></figure><p>But no stress, everything will be explained step by step to reach that.</p><p><em>Note:</em> As it is said here ([<a href=\"https://cloud.google.com/iot/docs/how-tos/mqtt-bridge#publishing_telemetry_events\" rel=\"noopener\">link</a>]), each message in the Cloud Pub/Sub topic contains a copy of the telemetry message published by the device but also some <strong>message attributes</strong>, the most important being probably <code>deviceID</code>, allowing us to match some received data with the device that published it.</p><p><em>Note:</em> We talk a lot about <strong>Pub(lish)</strong>, but where is the <strong>Sub(scribe)</strong>? In fact, we’ll create quickly with Google Cloud Command Line Interface a Cloud Pub/Sub subscription (a “pull” one) in order to view the messages published to the telemetry topic. Later in this post, we’ll create a Firebase Cloud Function reacting to each publication and this will automatically create another subscription (a “push” one this time).</p><p><strong>From Cloud Pub/Sub to data storage and visualization</strong></p><p>We’re following the right part of the project architecture diagram given at the beginning of this post:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*aN_fNiSZXWfgoNrHPmNXeQ.png\" class=\"kg-image\" alt=\"1*aN_fNiSZXWfgoNrHPmNXeQ\" width=\"571\" height=\"300\" loading=\"lazy\"><figcaption>Project Architecture — Weather data storage and visualization</figcaption></figure><p>A publication to the Cloud Pub/Sub topic will <strong>trigger a Firebase Cloud Function</strong> that will itself <strong>fulfill a Firebase Realtime Database</strong> with the new data. A web app hosted by<strong> Firebase Hosting </strong>will lively plot data from the Firebase Realtime Database, in the same way as we did in a previous post: [<a href=\"https://medium.com/@o.lourme/our-iot-journey-through-esp8266-firebase-angular-and-plotly-js-part-3-644048e90ca4\" rel=\"noopener\">link</a>].</p><p>There are other options in the Google ecosystem to store/treat/visualize data. <a href=\"https://www.freecodecamp.org/news/gcp-cloudiotcore-esp32-mongooseos-1st-5c88d8134ac7/undefined\" rel=\"noopener\">Alvaro Viebrantz</a>’s really good post [<a href=\"https://medium.com/google-cloud/build-a-weather-station-using-google-cloud-iot-core-and-mongooseos-7a78b69822c5\" rel=\"noopener\">link</a>] that helped us uses <strong>Big Query</strong> ([<a href=\"https://cloud.google.com/bigquery/\" rel=\"noopener\">link</a>]) and <strong>Data Studio</strong> ([<a href=\"https://datastudio.google.com\" rel=\"noopener\">link</a>]).</p><p><strong>Additional “config” and “state” topics</strong></p><p>On the project architecture diagram given at the beginning of this post, we see besides telemetry two other data flows: <strong>Config </strong>([<a href=\"https://cloud.google.com/iot/docs/how-tos/config/configuring-devices\" rel=\"noopener\">link</a>]) and <strong>State </strong>([<a href=\"https://cloud.google.com/iot/docs/how-tos/config/getting-state\" rel=\"noopener\">link</a>]):</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*kBpmaNkEksBh_SAju-XpxA.png\" class=\"kg-image\" alt=\"1*kBpmaNkEksBh_SAju-XpxA\" width=\"249\" height=\"156\" loading=\"lazy\"><figcaption>Config and State data flows</figcaption></figure><p>Indeed, the Cloud IoT Core service may publish <strong>configuration update messages</strong> to a special topic the device has subscribed to ([<a href=\"https://cloud.google.com/iot/docs/how-tos/config/configuring-devices\" rel=\"noopener\">link</a>]). It is useful when we need the device to go to a new state, <em>e.g.</em> by updating a parameter of its associated sensor, by changing a deep sleep period, moving a servomotor, etc.</p><p>For efficiency, there shouldn’t be more than one message of that type per second per device. Such a message is an arbitrary user-defined blob (we’ll use JSON), up to 64 kiB. At last, the name of this special MQTT topic is imperatively:</p><pre><code>/devices/{device-id}/config</code></pre><p>On the other hand, a device may publish to a special topic — that Cloud IoT Core has automatically subscribed to — <strong>messages concerning its state </strong>([<a href=\"https://cloud.google.com/iot/docs/how-tos/config/getting-state\" rel=\"noopener\">link</a>])<strong>, </strong><em>e.g.</em> quantity of RAM available, state of a button, etc. It is often used to see if the previous config message sent to the device had the desired effect.</p><p>For efficiency, this kind of publication shouldn’t be done more than once per second per device. Such a message is an arbitrary user-defined blob (we’ll use JSON), up to 64 kiB. At last, the topic to which the device publishes its state data has imperatively this name:</p><pre><code>/devices/{device-id}/state</code></pre><p><em>Note:</em> Sending<strong> commands </strong>to devices is also possible from Cloud IoT Core: see [<a href=\"https://cloud.google.com/iot/docs/how-tos/commands\" rel=\"noopener\">link</a>] but we won’t illustrate it.</p><blockquote>But for the moment, we will focus on telemetry. After this journey, in a “coming soon” post we will show how to handle <code><em>config</em></code> and <code><em>state</em></code> special topics.</blockquote><p>UPDATE March 29, 2019: This post about <code>config</code> and <code>state</code> special topics is out: [<a href=\"https://medium.com/@o.lourme/gcp-cloudiotcore-esp32-mongooseos-2nd-config-state-encrypt-7c5e937e5be9\" rel=\"noopener\">link</a>].</p><h3 id=\"mongoose-os-installation-on-devices\"><strong>Mongoose OS installation on devices</strong></h3><h4 id=\"1-a-short-description-of-mongoose-os\">1) A short description of Mongoose OS</h4><p><strong>Mongoose OS</strong> ([<a href=\"https://mongoose-os.com/\" rel=\"noopener\">link</a>], [<a href=\"https://lwn.net/Articles/733297/\" rel=\"noopener\">link</a>]) is a smart IoT-oriented OS, runnable on several chips, including ESP8266 and ESP32. Mongoose OS is in partnership with the major actors in IoT ([<a href=\"https://mongoose-os.com/about.html\" rel=\"noopener\">link</a>]). It comes with a development tool called <strong>mos</strong>, working either in a UI or with a Command Line Terminal (like <code>cmd.exe</code> in Windows). In either cases, we’ll write <code>mos</code> commands. There is also a device management app called mDash but we didn’t try it. <strong>Numerous APIs dealing with most of the network and sensor protocols are provided.</strong> Programs can be written in both C/C++ and JS.</p><p>At last, there is a 12-tutorial series on YouTube, really useful:</p><figure class=\"kg-card kg-embed-card\" data-test-label=\"fitted\">\n        <div class=\"fluid-width-video-container\">\n          <div style=\"padding-top: 56.25%;\" class=\"fluid-width-video-wrapper\">\n            <iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/videoseries?list=PLNOffh-6mSoRfxD4wTvRziUDUiSLSyJKE\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\" name=\"fitvid0\"></iframe>\n          </div>\n        </div>\n      </figure><p><em>Note:</em> We used Mongoose OS Community Edition, which is free, licensed under Apache 2.0.</p><h4 id=\"2-mongoose-os-installation-on-esp32\">2) Mongoose OS installation on ESP32</h4><p>This installation has to be performed on each device.</p><p>We head to the <strong>developers section</strong> of Mongoose OS web site ([<a href=\"https://mongoose-os.com/docs/quickstart/setup.md\" rel=\"noopener\">link</a>]) in order to perform the <strong>first seven steps</strong> of the list given in this resource:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*LZbBhMBqdngkZwdJrmtANg.png\" class=\"kg-image\" alt=\"1*LZbBhMBqdngkZwdJrmtANg\" width=\"800\" height=\"183\" loading=\"lazy\"><figcaption>Mongoose OS setup steps</figcaption></figure><p><strong>Step #1</strong>, <strong>Step #2</strong> and <strong>Step #3</strong> are trivial. At Step #3 don’t forget to connect the device to the host machine via a USB cable.</p><p>For <strong>Step #4 </strong>“Create new app”, we choose to call the app <code>app1</code>. When <code>mos clone https://github.com/mongoose-os-apps/demo-js app1</code> indicated on the web site is completed, mos tool automatically goes to the just created <code>app1/</code> folder.</p><p>In <code>app1/fs/</code> folder, there is a source file called <code>init.js</code>. It is a demo file capable to communicate with different IoT platforms (if they are configured of course). We will basically test it and soon simplify it for our purposes.</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*5GYs7d1Ws_km6oDnWPaa6Q.png\" class=\"kg-image\" alt=\"1*5GYs7d1Ws_km6oDnWPaa6Q\" width=\"800\" height=\"449\" loading=\"lazy\"><figcaption><strong>mos tool</strong> launched in a UI ; ESP32 selected; Serial console (on the right) is by default at 115200 bds, ESP32’s default speed.</figcaption></figure><p><strong>Step #5</strong> “Build app firmware” is launched with <code>mos build</code> command (add <code>--arch esp32</code> to this command if you launch it from a Command Line Terminal, not from mos tool). It may take a while but normally we have to perform this build only once. After it, we have many more files. One called <code>app1/build/fw.zip</code> contains the binaries of the OS and <code>init.js</code>. It will be flashed to ESP32 in the next step.</p><p><strong>Step #6</strong> “Flash firmware” is launched with <code>mos flash</code> command. It has normally to be done just once. Even if later we change some files (like <code>init.js</code> for instance), we will use a <code>mos put</code> command to upload a file from the host machine to the <strong>local device’s file system</strong>. Of course this command is only available after the flash process.</p><p><em>Note:</em> Firmware flash step can be tricky with a brand new ESP32. With our ESP32 DEVKIT V1, we had messages in console (that’s a first good point!) reporting issues about failing to connect to ESP32 ROM. Retrying to flash by pressing the BOOT button (closed to USB connector) finally turned out to a successful flash. Though, be ready to wait for one minute or two.</p><p>Then, the device automatically reboots and executes <code>init.js</code>. We obtained every second the following information in mos console (or in any serial terminal @115200 bds) :</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*0i3bn3fhEkAolrkfvBjQVg.png\" class=\"kg-image\" alt=\"1*0i3bn3fhEkAolrkfvBjQVg\" width=\"800\" height=\"22\" loading=\"lazy\"><figcaption>Console after initial ESP32 flash firmware with Mongoose OS</figcaption></figure><p>In <strong>Step #7</strong> we connect ESP32 to our wifi network (we use mos tool):</p><pre><code>mos wifi WIFI_NETWORK_NAME WIFI_PASSWORD</code></pre><p>The device will reboot by itself after getting an IP address and synchronizing time by contacting a SNTP server. We then ping our device to check its internet connexion.</p><p><em>Note: </em>We get device information (IP address for instance) by hitting <strong>CTRL+i </strong>in mos tool, or by typing <code>mos call Sys.GetInfo</code>.</p><p><em>Note: </em>We reset the device by hitting <strong>CTRL+u</strong> in mos tool, or by typing <code>mos call Sys.Reboot</code>.</p><p><em>Note: </em>Steps #5, #6 and #7 could be the beginning of a “provisioning script”, useful if we have many devices to setup. It is optional to rerun Step #5 if all devices are the same, <em>e.g.</em> only ESP32.</p><h4 id=\"3-esp32-hello-world-program-with-mongoose-os\">3) ESP32 “Hello, World!” program with Mongoose OS</h4><p>To get used to Mongoose OS JS programming style and mos tool, let’s write a small program whose aim is to make the blue built-in LED blink and print messages on console. <strong>This led is connected to GPIO2 pin</strong> of ESP32 DEVKIT V1 (see Assembly Diagram at the beginning of this post). On our host machine, let’s replace the content of <code>app1/fs/init.js</code> by this one:</p><pre><code class=\"language-js\">/*\n ESP32 DEVKIT V1 - Mongoose OS\n Built-in LED blink and console log\n This blue LED is connected to GPIO2.\n See: \n - https://mongoose-os.com/docs/mos/api/core/mgos_timers.h.md\n*/\n\nload('api_config.js');\nload('api_gpio.js');\nload('api_timer.js');\n\nlet pin = 2;\n\nGPIO.set_mode(pin, GPIO.MODE_OUTPUT);\n\n// Call every 2 seconds\nTimer.set(2000, Timer.REPEAT, function() {\n  let value = GPIO.toggle(pin);\n  print(value ? 'Tick' : 'Tock');\n}, null);</code></pre><p>From mos tool or from a Command Line Terminal, we upload this file to Mongoose OS file system and finally we reboot the device:</p><pre><code>mos put fs/init.js\nmos call Sys.Reboot</code></pre><p>The blue led should blink and we should see alternatively <code>Tick</code> and <code>Tock</code> printed on console.</p><h4 id=\"4-dht22-test-with-mongoose-os\">4) DHT22 test with Mongoose OS</h4><p>At the beginning of this post, there is an Assembly Diagram showing how to connect DHT22 sensor with ESP32 DEVKIT V1. We chose to connect <strong>DHT22 data pin</strong> <strong>to GPIO0 of ESP32 DEVKIT V1</strong>.</p><p>So, here is another short <code>init.js</code> program. This one prints periodically to serial console DHT22 measures (temperature and humidity - as an object in JSON, no MQTT publication yet):</p><pre><code class=\"language-js\">/*\n ESP32 DEVKIT V1 - Mongoose OS\n DHT22 sensor measures are sent to console.\n DHT22 data pin is connnected to GPIO0.\n See: \n - https://mongoose-os.com/docs/quickstart/develop-in-js.md\n - https://mongoose-os.com/docs/mos/api/drivers/dht.md\n*/\n\nload('api_config.js');\nload('api_dht.js');\nload('api_timer.js');\n\nlet pin = 0;\nlet dht = DHT.create(pin, DHT.DHT22);\n\nTimer.set(5000, true, function() { // timer period is in ms\n  let msg = JSON.stringify({temperature: dht.getTemp(), humidity: dht.getHumidity()});\n  print(msg);\n}, null);</code></pre><p>Then:</p><pre><code>mos put fs/init.js\nmos call Sys.Reboot</code></pre><p>And this is the related console we get after uploading the <code>init.js</code> program and rebooting the device. Humidity is in % and temperature is in Celsius degrees:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*2xr980fPqZCYC84iUq4qEw.png\" class=\"kg-image\" alt=\"1*2xr980fPqZCYC84iUq4qEw\" width=\"626\" height=\"82\" loading=\"lazy\"><figcaption>DHT22 measures as printed to console. A bit too accurate, isn’t it ?</figcaption></figure><p>Numbers seem to have a long decimal part but this will be fixed later within a Cloud Function.</p><p><em>Note:</em> For pedagogical purposes, we chose all over this post explicit long key names like <code>temperature</code> or <code>humidity</code>. This will have consequences on the volume of data stored later in a NoSQL database (Firebase Realtime Database) as those keys will be repeated for each measure. Shorter key names could be a good idea.</p><h4 id=\"5-let-s-publish-data-to-the-mqtt-telemetry-topic\">5) Let’s publish data to the MQTT telemetry topic</h4><p><strong>This is our last program, the one ready to work with Cloud IoT Core!</strong> On the previous program, we just add a publication to the telemetry topic we already talked about: <code>/devices/{device-id}/events</code>.</p><p>Note that messages are published in JSON as it will facilitate later their content retrieval with the Firebase Cloud Function reacting to messages publication.</p><pre><code class=\"language-js\">/*\n ESP32 DEVKIT V1 - Mongoose OS\n DHT22 sensor measures are sent to console.\n DHT22 data pin is connnected to GPIO0.\n Publishes weather data to the appropriate topic.\n \n See: \n - https://mongoose-os.com/docs/quickstart/develop-in-js.md\n - https://mongoose-os.com/docs/mos/api/drivers/dht.md\n - https://mongoose-os.com/docs/mos/api/net/mqtt.md\n*/\n\nload('api_config.js');\nload('api_dht.js');\nload('api_timer.js');\nload('api_mqtt.js');\n\n// Telemetry topic must have this name:\nlet topic = '/devices/' + Cfg.get('device.id') + '/events';\n\nlet pin = 0;\nlet dht = DHT.create(pin, DHT.DHT22);\n\nTimer.set(5000, true, function() { // timer period is in ms\n  let msg = JSON.stringify({temperature: dht.getTemp(), humidity: dht.getHumidity()});\n  // Publish message with a QoS 1\n  // MQTT.pub() returns 1 in case of success, 0 otherwise.\n  let ok = MQTT.pub(topic, msg, 1); \n  print(ok, msg);\n}, null);</code></pre><p>We name this file <code>init.js</code>, upload it to Mongoose file system, then provoke a reset:</p><pre><code>mos put fs/init.js\nmos call Sys.Reboot</code></pre><p><em>Note: </em>These commands could be appended to the “provisioning script” we mentioned earlier.</p><p>When running, this last program prints data to console but it fails to publish data to the MQTT bridge of Cloud IoT Core (<code>MQTT.pub()</code> returns 0):</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*Q-FIqugYuMQGd5rjjeu56Q.png\" class=\"kg-image\" alt=\"1*Q-FIqugYuMQGd5rjjeu56Q\" width=\"646\" height=\"95\" loading=\"lazy\"><figcaption>Telemetry data can still not be published as we haven’t set up a Google Cloud project yet.</figcaption></figure><p>Indeed, we haven’t set up any Google Cloud project yet, neither <em>a fortiori </em>registered a single device to it. Let’s do it now!</p><h3 id=\"cloud-iot-core-project-setup\">Cloud IoT Core project setup</h3><h4 id=\"1-google-cloud-sdk-installation\">1) Google Cloud SDK installation</h4><p>Firstly we need to <strong>install Google Cloud SDK</strong> because we will have to type some <code><strong>gcloud</strong></code><strong> commands</strong> in a Command Line Terminal. At the time of writing, it requires Python 2.7. It won’t work with Python 3.5. The Google Cloud SDK download page ([<a href=\"https://cloud.google.com/sdk/downloads\" rel=\"noopener\">link</a>]) offers versions of the SDK with Python bundled inside (if you’re sure you don’t have Python already installed and don’ t want to handle this Python point).</p><p>Then, Cloud IoT Core requires some <strong>Beta versions of <code>gcloud</code> commands</strong>. So in a Command Line Terminal, from any folder, we type:</p><pre><code>gcloud components install beta</code></pre><p>These two previous steps have to be done just one time!</p><p><em>Note:</em> Most of the following actions on Google IoT Core can be performed in three ways:</p><ul><li>with <strong>Google Cloud Console</strong> (on the web)</li><li>with <strong>some APIs</strong> in different languages, and</li><li>with <strong>Command Line Interface</strong> in a terminal, typing <code>gcloud</code> commands.</li></ul><p>We will use the latter to configure things and we’ll check facts with Google Cloud Console (on the web).</p><h4 id=\"2-google-cloud-project-setup\">2) Google Cloud project setup</h4><p>We follow now this guide from Mongoose OS web site : [<a href=\"https://mongoose-os.com/docs/quickstart/cloud/google.md\" rel=\"noopener\">link</a>].</p><pre><code># Commands indicated in this grey frame have to be done just once to configure the Google Cloud project! They can be performed from any folder.\n\n# Get authenticated with Google Cloud\ngcloud auth login\n\n# Create cloud project. We chose hello-cloud-iot-core as PROJECT_ID\ngcloud projects create hello-cloud-iot-core\n\n# Give Cloud IoT Core permission to publish to Pub/Sub topics\ngcloud projects add-iam-policy-binding hello-cloud-iot-core --member=serviceAccount:cloud-iot@system.gserviceaccount.com --role=roles/pubsub.publisher\n\n# Set default project for gcloud\ngcloud config set project hello-cloud-iot-core\n\n# Create Pub/Sub topic for device telemetry\ngcloud beta pubsub topics create weather-telemetry-topic\n\n# Create a Pub/Sub subscription to the just created topic\ngcloud beta pubsub subscriptions create --topic weather-telemetry-topic weather-telemetry-subscription\n\n# Create devices registry (we call it weather-devices-registry)\n\n# Precise Pub/Sub topic name for event notifications\n\n# Disallow device connections to the HTTP bridge\ngcloud beta iot registries create weather-devices-registry --region europe-west1 --no-enable-http-config --event-notification-config=topic=weather-telemetry-topic\n\n# Say 'yes' to enable API (if prompted).\n\n# But the last command may not work all the same\n\n# if you don't enable billing.\n\n# So, follow the link to enable billing and retry last command.\n\n# It should end up to \"Created registry [weather-devices-registry].\"</code></pre><h4 id=\"3-device-registration-within-the-cloud-iot-core-project\">3) Device registration within the Cloud IoT Core project</h4><p>Let’s now register the devices to the project! One at a time of course. <strong>mos tool is really helpful for this task. </strong>From mos tool launched in its UI or from Command Line Terminal, placed in our <code>app1</code> folder, we type the following command (project id and registry name are involved, as you see):</p><pre><code># Register device with Cloud IoT Core (do it for each device!)\nmos gcp-iot-setup --gcp-project hello-cloud-iot-core --gcp-region europe-west1 --gcp-registry weather-devices-registry</code></pre><p><em>Note: </em>This command could be the last one of the “provisioning script” we mentioned already twice.</p><p>This command is a <code>mos</code> command that will itself use <code>gcloud</code> commands. The device about to be registered must be connected via the serial port to our host computer because some information will be uploaded to it just like keys, MQTT bridge address, etc.</p><p>Indeed, we see on mos console that <strong>two keys (one private, one public) are generated</strong>. We can inspect them in <code>app1</code> project folder. The private one is for ESP32 and the public one is for Google IoT Core. They are used during the authentication process involving the JSON Web Token we mentioned earlier.</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*iVJ-dbpnqmQJqwuGFC917A.png\" class=\"kg-image\" alt=\"1*iVJ-dbpnqmQJqwuGFC917A\" width=\"354\" height=\"335\" loading=\"lazy\"><figcaption>Pair of keys just generated (private and public)</figcaption></figure><p><em>Note concerning security: </em><strong>The private key shouldn’t be stored in plain text in ESP32 flash memory</strong>. This is why we describe in the post following this one ([<a href=\"https://medium.com/@o.lourme/gcp-cloudiotcore-esp32-mongooseos-2nd-config-state-encrypt-7c5e937e5be9\" rel=\"noopener\">link</a>]) how to encrypt this memory. Also, <strong>the private key file shouldn’t be stored in plain text on the host development computer</strong>. At least, protect access to its content with a password.</p><p>When the device reboots, we see in the console that it successfully connects to the Google MQTT bridge and publishes telemetry messages (<code>MQTT.pub()</code> returns 1):</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*H9T-zF4B-HwYgO_ZdratEw.png\" class=\"kg-image\" alt=\"1*H9T-zF4B-HwYgO_ZdratEw\" width=\"646\" height=\"95\" loading=\"lazy\"><figcaption>Publications to MQTT bridge are successful. Nice job!</figcaption></figure><h4 id=\"4-checking-the-project-setup-in-google-cloud-console\">4) Checking the project setup in Google Cloud Console</h4><p>We head to <a href=\"https://console.cloud.google.com/iot/\" rel=\"noopener\">https://console.cloud.google.com/iot/</a> to check that everything was well configured:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*BeVR0exU6l-rXg8LqJvfeQ.jpeg\" class=\"kg-image\" alt=\"1*BeVR0exU6l-rXg8LqJvfeQ\" width=\"800\" height=\"264\" loading=\"lazy\"><figcaption>Project ID, registry ID and telemetry Pub/Sub topic name in Google Cloud Console</figcaption></figure><p>Clicking on the <strong>Registry ID</strong> <code>weather-devices-registry</code> reaches another screen. Clicking on “Devices” on this new screen lists provisioned devices and gives details like the last time they were seen (but this is not a live update, we have to refresh the page):</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*sfa7ErglL4OqCsk2jIZqUA.png\" class=\"kg-image\" alt=\"1*sfa7ErglL4OqCsk2jIZqUA\" width=\"800\" height=\"326\" loading=\"lazy\"><figcaption>Devices View in Google Cloud Console</figcaption></figure><p>Clicking on the <strong>Telemetry Pub/Sub topic</strong> name goes to <strong>Pub/Sub console</strong> to show the subscription we created before, <em>i.e.</em> the one related to the telemetry topic:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*EQ1r5SozuzjM5Jrbl4vdVg.png\" class=\"kg-image\" alt=\"1*EQ1r5SozuzjM5Jrbl4vdVg\" width=\"760\" height=\"392\" loading=\"lazy\"><figcaption>Google Cloud Console (Pub/Sub) — names of topic and related subscription</figcaption></figure><h4 id=\"5-viewing-at-last-some-telemetry-data\">5) Viewing at last some telemetry data</h4><p>Now it would be nice to see the data that devices are publishing. For this, we have the subscription we already created. From any folder of the host computer, we type:</p><pre><code>gcloud beta pubsub subscriptions pull --auto-ack weather-telemetry-subscription --limit=2</code></pre><p>This command ([<a href=\"https://cloud.google.com/sdk/gcloud/reference/beta/pubsub/subscriptions/pull\" rel=\"noopener\">link</a>]) pulls until <strong><em>2</em></strong> Pub/Sub messages from our <code>weather-telemetry-subscription</code> subscription. We can see data in JSON, messages ids and a list of attributes for each message. Among them the <code>deviceId</code> attribute is present. Unfortunately there are no timestamps, we’ll see how to get them later.</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*78OYVPPUeKZWRRvlWdI4Mg.png\" class=\"kg-image\" alt=\"1*78OYVPPUeKZWRRvlWdI4Mg\" width=\"800\" height=\"267\" loading=\"lazy\"><figcaption>Result of pulling telemetry messages from a subscription</figcaption></figure><blockquote>If you have reached this milestone, congrats! We’re now ready to write a Firebase Cloud Function reacting to each publication to the Pub/Sub telemetry topic!</blockquote><h3 id=\"logging-storing-and-visualizing-weather-data-with-firebase\">Logging, storing and visualizing weather data with Firebase</h3><h4 id=\"1-introduction\">1) Introduction</h4><p>We’re now tackling this part of the project:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*UwR_qn8GX1b2CkMA62kT3w.png\" class=\"kg-image\" alt=\"1*UwR_qn8GX1b2CkMA62kT3w\" width=\"503\" height=\"302\" loading=\"lazy\"><figcaption>The part we study now</figcaption></figure><p>On that diagram, we see that our project needs 3 Firebase products :</p><p>A <strong>Firebase Cloud Function</strong> (more exactly “a Cloud Function for Firebase”) must react to any publication to the telemetry topic in order to store the weather data of this publication to a <strong>Firebase Realtime Database</strong>. This storage allows weather data persistence and is used to feed a web app hosted by <strong>Firebase Hosting</strong>. This web app draws live plots of this weather data across time.</p><p>The good new is that it’s possible to configure all these products with one command.</p><h4 id=\"2-firebase-configuration-github-repository\"><strong>2) Firebase configuration, GitHub repository</strong></h4><p>We are still working on the same Google Cloud project called <code>hello-cloud-iot-core</code>. Firebase will just “enhance” this project with its products.</p><p>We made a GitHub repository for the Firebase aspects of our project:</p><p><a href=\"https://github.com/olivierlourme/iot-store-display\" rel=\"noopener\"><strong>olivierlourme/iot-store-display</strong></a><br><a href=\"https://github.com/olivierlourme/iot-store-display\" rel=\"noopener\"><em>Contribute to olivierlourme/iot-store-display development by creating an account on GitHub.</em>github.com</a></p><p>Clone this repository in your favorite development folder and head to the newly created directory:</p><pre><code>c:\\_app&gt;git clone https://github.com/olivierlourme/iot-store-display\nc:\\_app&gt;cd iot-store-display</code></pre><p><strong>Global Firebase configuration</strong></p><p><em>Note:</em> We suppose you have <strong>Firebase tools</strong> installed (<em>i.e. </em>Node.js installed and <code>npm install -g firebase-tools</code> was run, see [<a href=\"https://firebase.google.com/docs/functions/get-started\" rel=\"noopener\">link</a>] for details).</p><p>Let’s perform the Firebase initializations:</p><pre><code>c:\\_app\\iot-store-display&gt;firebase init </code></pre><p>First step is to choose Firebase products we want to use:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*FYoZkLMMrQBQDflK8Z46fQ.png\" class=\"kg-image\" alt=\"1*FYoZkLMMrQBQDflK8Z46fQ\" width=\"720\" height=\"522\" loading=\"lazy\"><figcaption>Choosing Firebase products</figcaption></figure><p>We are then prompted to associate the current directory (<code>iot-store-display</code>) with one of the listed Firebase projects. The problem is that our project <code>hello-cloud-iot-core</code> doesn’t appear in the list because before being a Firebase project it’s also a Google Cloud project! Read <a href=\"https://www.freecodecamp.org/news/gcp-cloudiotcore-esp32-mongooseos-1st-5c88d8134ac7/undefined\" rel=\"noopener\">Doug Stevenson</a>’s posts for relationships between Firebase and Google Cloud: [<a href=\"https://medium.com/google-developers/whats-the-relationship-between-firebase-and-google-cloud-57e268a7ff6f\" rel=\"noopener\">link</a>] and [<a href=\"https://medium.com/google-developers/firebase-google-cloud-whats-different-with-cloud-functions-612d9e1e89cb\" rel=\"noopener\">link</a>].</p><p>To overcome this, first we hit CTRL+C to stop this initialization process and then we go to<strong> Firebase Console</strong> at <a href=\"https://console.firebase.google.com\" rel=\"noopener\">https://console.firebase.google.com</a>. We choose “Add a project”:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*nOcFfL_ZwGUKGe-PDnsZUQ.png\" class=\"kg-image\" alt=\"1*nOcFfL_ZwGUKGe-PDnsZUQ\" width=\"606\" height=\"117\" loading=\"lazy\"><figcaption>Firebse Console — Add a project</figcaption></figure><p>And we can see our project (with Google Cloud logo) and choose it:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*QqI3k8bH5P348eAInetTOQ.png\" class=\"kg-image\" alt=\"1*QqI3k8bH5P348eAInetTOQ\" width=\"392\" height=\"227\" loading=\"lazy\"><figcaption>Fierbase Console — Even Google Cloud projects are listed.</figcaption></figure><p><em>Note:</em> You might then be asked to confirm Firebase billing plan if the Google Cloud project itself has a billing plan.</p><p>Great! We restart the Firebase initialization with <code>firebase init</code> command and this time our Google Cloud project <code>hello-cloud-iot-core</code> is listed. We choose it:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*qr4CKgpdnEG9UorzVv3yrw.png\" class=\"kg-image\" alt=\"1*qr4CKgpdnEG9UorzVv3yrw\" width=\"513\" height=\"105\" loading=\"lazy\"><figcaption>Our <code><strong>iot-store-display</strong></code> directory is associated with <strong>hello-cloud-iot-core </strong>project.</figcaption></figure><p><em>Note:</em> If you still don’t see your project you might be logged to Firebase without the correct Google account. In this case, type <code>firebase logout</code> followed by <code>firebase login</code>.</p><p><strong>Realtime Database configuration</strong></p><p>Then the wizard asks a single question about the Realtime Database and its rules: the name of the file where they will be saved. We maintain the default name. It’s more practical to have these rules in a file lying in the project directory than to go to Firebase Console as we did in past posts. We will detail these rules later.</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*YtlGoKNyjspvirVxSoXYNg.png\" class=\"kg-image\" alt=\"1*YtlGoKNyjspvirVxSoXYNg\" width=\"710\" height=\"129\" loading=\"lazy\"><figcaption>Name of file storing Realtime Database rules</figcaption></figure><p><strong>Cloud Functions configuration</strong></p><p>Here are the answers we made to the wizard concerning Functions Setup:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*ml7Pc1OSEgqi6dRsy5J_aA.png\" class=\"kg-image\" alt=\"1*ml7Pc1OSEgqi6dRsy5J_aA\" width=\"733\" height=\"235\" loading=\"lazy\"><figcaption>Cloud Functions setup</figcaption></figure><p>Of course, we choose not to overwrite the <code>functions/index.js</code> file obtained from <a href=\"https://github.com/olivierlourme/iot-store-display\" rel=\"noopener\">GitHub</a>.</p><p><strong>Firebase Hosting configuration</strong></p><p>And here are the answers we made to the wizard concerning Hosting Setup:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*F_7qI1Norg4qjQfPhouCWw.png\" class=\"kg-image\" alt=\"1*F_7qI1Norg4qjQfPhouCWw\" width=\"704\" height=\"342\" loading=\"lazy\"><figcaption>Hosting setup</figcaption></figure><p>Of course we choose not to overwrite the <code>public/index.html</code> file obtained from <a href=\"https://github.com/olivierlourme/iot-store-display\" rel=\"noopener\">GitHub</a>.</p><p><strong>Deploying (not now!)</strong></p><p>Later, if we want to deploy some updates we made to our 3 products, we can type globally:</p><pre><code>c:\\_app\\iot-store-display&gt;firebase deploy</code></pre><p>But if we want to deploy only, respectively:</p><ul><li>updated database rules,</li><li>updated cloud functions,</li><li>updated web app,</li></ul><p>we type, respectively:</p><pre><code>firebase deploy --only database\nfirebase deploy --only functions\nfirebase serve --only hosting (local deployment) OR firebase deploy --only hosting (remote deployment)</code></pre><h4 id=\"3-pub-sub-trigger-cloud-function\">3) Pub/Sub trigger Cloud Function</h4><p><strong>Introduction</strong></p><p>In a past post, we explained that we could write <strong>Firebase Cloud Functions</strong> triggered on some events happening to some of the Google products.</p><p><a href=\"https://medium.com/@o.lourme/our-iot-journey-through-esp8266-firebase-angular-and-plotly-js-part-2-14b0609d3f5e\" rel=\"noopener\"><strong>Post 2 of 3. Our IoT journey through ESP8266, Firebase and Plotly.js</strong></a><br><a href=\"https://medium.com/@o.lourme/our-iot-journey-through-esp8266-firebase-angular-and-plotly-js-part-2-14b0609d3f5e\" rel=\"noopener\"><em>A Firebase Cloud Function appends a timestamp to each value pushed to a Firebase Realtime Database.</em>medium.com</a></p><p><strong>Cloud Pub/Sub</strong> is one of these products and so it is possible to trigger a function each time a message is published to a Pub/Sub topic : [<a href=\"https://firebase.google.com/docs/functions/pubsub-events\" rel=\"noopener\">link</a>].</p><p>So if the Firebase Cloud Function is triggered on each publication to the <code>weather-telemetry-topic</code> topic, watching its log will allow us to watch the telemetry topic’s activity.</p><p>The code of the Cloud Function has to store each new published data to the Firebase Realtime Database associated with our project.</p><p><strong>Cloud Function source code</strong></p><p>The beginning of the source code looks like this:</p><pre><code>exports.detectTelemetryEvents = functions.pubsub.topic('weather-telemetry-topic').onPublish(\n    (message, context) =&gt; {...</code></pre><p>The full Cloud Function source code lies in the file named <code>index.js</code>. This file is in the <code>functions</code> folder of our <code>iot-store-display</code> directory on <a href=\"https://github.com/olivierlourme/iot-store-display\" rel=\"noopener\">GitHub</a>. It is fully commented, so run and study it, it’s short and not complicated.</p><p><strong>Cloud Function deployment</strong></p><p>It’s time to deploy the Cloud Function:</p><pre><code>c:\\_app\\iot-store-display&gt;firebase deploy --only functions</code></pre><p><strong>Cloud Function validation</strong></p><p>Once Cloud Function is deployed, we can watch the Cloud Function logs and among other things, we’ll see the results of the <code>console.log(`Device=${deviceId}...)</code> we wrote at the end of <code>index.js</code>.</p><p>Where to see those logs? We have two opportunities:</p><ul><li>in Firebase Console (<a href=\"https://console.firebase.google.com\" rel=\"noopener\">https://console.firebase.google.com</a>):</li></ul><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*SH9086pyf8yyuEnyCDu0UQ.png\" class=\"kg-image\" alt=\"1*SH9086pyf8yyuEnyCDu0UQ\" width=\"800\" height=\"283\" loading=\"lazy\"><figcaption>Firebase Console — Firebase Cloud Functions logs</figcaption></figure><ul><li>in Google Cloud Console (<a href=\"https://console.cloud.google.com/functions/\" rel=\"noopener\">https://console.cloud.google.com/functions/</a>):</li></ul><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*D3QmCuAsqE5jUkuIyPTB-w.png\" class=\"kg-image\" alt=\"1*D3QmCuAsqE5jUkuIyPTB-w\" width=\"800\" height=\"308\" loading=\"lazy\"><figcaption>Google Cloud Console — Access to <strong>Cloud Function logs</strong> and to <strong>Cloud Function deletion</strong></figcaption></figure><p>We prefer this latter solution, as logs are clearer:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*kgpwdupeMVLKQ2msHpO4cQ.png\" class=\"kg-image\" alt=\"1*kgpwdupeMVLKQ2msHpO4cQ\" width=\"800\" height=\"244\" loading=\"lazy\"><figcaption>Google Cloud Console- Cloud Functions logs</figcaption></figure><p>Concerning storage, here is what lies in Firebase Realtime Database after each device has made 2 telemetry data publication. Data is of course sorted by device as we specified it in <code>index.js</code>:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*gJX7raPOkRvRZzAHhQC14Q.png\" class=\"kg-image\" alt=\"1*gJX7raPOkRvRZzAHhQC14Q\" width=\"800\" height=\"584\" loading=\"lazy\"><figcaption>Firebase Console — Realtime Database after 2 telemetry data publications per device</figcaption></figure><p><em>Note: </em>Don’t forget to <strong>delete your Cloud Function</strong> on Google servers if you don’t use it, otherwise you might either reach the invocation quota or pay for service you don’t use, as indicated here: [<a href=\"https://medium.com/@o.lourme/our-iot-journey-through-esp8266-firebase-angular-and-plotly-js-part-2-14b0609d3f5e\" rel=\"noopener\">link</a>]. Function deletion is to be performed on Google Cloud Console (see “Delete”, 3 screenshots above).</p><p><em>Note:</em> The Cloud Function has admin rights over the database, whatever is the content of the <code>database.rules.json</code> file. At this step, the <code>database.rules.json </code>file can still be very restrictive. Don’t forget to deploy them, once edited.</p><pre><code class=\"language-js\">{\n  \"rules\": {\n    \".read\": false,\n    \".write\": false\n  }\n}</code></pre><h4 id=\"4-a-web-app-using-firebase-and-plotlys-js-to-visualize-weather-data\">4) A web app using Firebase and plotlys.js to visualize weather data</h4><p><strong>Introduction</strong></p><p><em>Note:</em> We’re now building a “homemade” (and satisfying) data visualization solution. For enhanced UI (dashboard, etc.), maybe you should investigate Data Studio we already mentioned elsewhere in this post.</p><p>We focus on <strong>building a small web</strong> app, hosted by <strong>Firebase Hosting</strong>. This web app <strong>lively plots</strong> the data stored in the Firebase Realtime Database. We used <a href=\"https://www.freecodecamp.org/news/gcp-cloudiotcore-esp32-mongooseos-1st-5c88d8134ac7/undefined\" rel=\"noopener\">plotly</a> (<a href=\"https://plot.ly/javascript/\" rel=\"noopener\">https://plot.ly/javascript/</a>) for the plotting library. We are familiar with that work as we already undertook a similar one in a previous post:</p><p><a href=\"https://medium.com/@o.lourme/our-iot-journey-through-esp8266-firebase-angular-and-plotly-js-part-3-644048e90ca4\" rel=\"noopener\"><strong>Post 3 of 3. Our IoT journey through ESP8266, Firebase and Plotly.js</strong></a><br><a href=\"https://medium.com/@o.lourme/our-iot-journey-through-esp8266-firebase-angular-and-plotly-js-part-3-644048e90ca4\" rel=\"noopener\"><em>A web app hosted by Firebase Hosting susbscribes to the data stream coming from a Firebase Realtime Database and plot…</em>medium.com</a></p><p>What’s different today is that we have to:</p><ul><li>draw several charts: temperature <em>vs</em> time and humidity <em>vs</em> time,</li><li>inside each chart, we have one plot per device.</li></ul><p><strong>Database rules &amp; devices-ids node</strong></p><p>Concerning the database rules, what should be now the <code>database.rules.json</code> file? The <code>device-telemetry</code> node needs to be <strong>read </strong>by the web app. And if you looked attentively at the Realtime Database screenshot given a few screenshots before, there is another node called <code>devices-ids</code>.</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*Si6-O12MUJXpzN3qyZyBVg.png\" class=\"kg-image\" alt=\"1*Si6-O12MUJXpzN3qyZyBVg\" width=\"335\" height=\"248\" loading=\"lazy\"><figcaption>Firebase Console — Detail of devices-ids node in Realtime Database</figcaption></figure><p>You need to create <strong>manually in the Firebase Console</strong> this <code>devices-ids</code> node and fill it appropriately for the web app to work properly. It is a simple mean to declare to the web app the devices we want plots for and also to give aliases to the devices. Its role and necessity are fully explained in comments of the <code>public/script.js</code> file given in <a href=\"https://github.com/olivierlourme/iot-store-display\" rel=\"noopener\">GitHub</a>.</p><p><em>Note:</em> An improvement could be a form (accessed through authentication) that, once fulfilled, calls a script to generate this <code>devices-ids</code> node.</p><p>This <code>devices-ids</code> node also needs to be read by the web app. So the <code>database.rules.json</code> file should eventually become:</p><pre><code class=\"language-js\">{\n  \"rules\": {\n    \"devices-ids\": {\n      \".read\": true,\n      \".write\": false\n    },\n    \"devices-telemetry\": {\n      \".read\": true,\n      \".write\": false\n    }\n  }\n}</code></pre><p>These new rules, once edited and saved, must be deployed with:</p><pre><code>c:\\_app\\iot-store-display&gt;firebase deploy --only database</code></pre><p><strong>Web app source code</strong></p><p>The web app source code lies in the <code>public</code> directory of our <code>hello-cloud-iot-core</code> folder or in <a href=\"https://github.com/olivierlourme/iot-store-display\" rel=\"noopener\">GitHub</a>. The content of the folder, especially <code>script.js</code>, is fully commented so you know where to study (and improve!) it.</p><p><em>Note: </em>we have only two devices for this demo but the source code is okay for <em>x</em> devices as long as you declare them in the <code>devices-ids</code> node.</p><p><strong>Web app local deployment and validation</strong></p><p>For testing purposes, Firebase Hosting can launch a local live server:</p><pre><code>c:\\_app\\iot-store-display&gt;firebase serve --only hosting</code></pre><p>We head to <code>http://localhost:5000</code> and we’re happy to get this:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*02UfatBLkuqCD12-JNBgjw.gif\" class=\"kg-image\" alt=\"1*02UfatBLkuqCD12-JNBgjw\" width=\"800\" height=\"599\" loading=\"lazy\"><figcaption>At last the charts we wanted!</figcaption></figure><p><strong>Web app remote deployment</strong></p><p>At last, Firebase offers us the hosting of our web app and an access to it via https:</p><pre><code>c:\\_app\\iot-store-display&gt;firebase deploy --only hosting</code></pre><p>We quickly get the public URL of our web app : <a href=\"https://hello-cloud-iot-core.firebaseapp.com\" rel=\"noopener\">https://hello-cloud-iot-core.firebaseapp.com</a></p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn-media-1.freecodecamp.org/images/1*EZjq0siYgb0K6sMaFHlk4Q.png\" class=\"kg-image\" alt=\"1*EZjq0siYgb0K6sMaFHlk4Q\" width=\"534\" height=\"86\" loading=\"lazy\"><figcaption>Web app deployment is complete!</figcaption></figure><p><em>Note: </em>If you have your own domain, you can connect your Firebase web app to it. See [<a href=\"https://firebase.google.com/docs/hosting/custom-domain\" rel=\"noopener\">link</a>].</p><h3 id=\"conclusion\">Conclusion</h3><p>In this post we discovered how to combine <strong>ESP32</strong>, <strong>Mongoose OS</strong> and <strong>Cloud IoT Core, </strong>obtaining a serious, secure and <strong>professional IoT project</strong>. Now that we know, it can go really fast to provision 10, 100… 1000 devices acquiring weather data all over an area, as long as they can get a Wifi connection. Now, devices are centrally managed, it is easy to provision and monitor them. But we can go further!</p><p>Indeed, in addition to this post, there is a second one ([<a href=\"https://medium.com/@o.lourme/gcp-cloudiotcore-esp32-mongooseos-2nd-config-state-encrypt-7c5e937e5be9\" rel=\"noopener\">link</a>]). Inside it:</p><ul><li>We’ll focus on ESP32 flash <strong>memory encryption</strong>, to achieve a fully secured system.</li><li>We’ll see how to use the <code>config</code> special topic, allowing us to <strong>trig an action on the device from the Google Cloud Console</strong>.</li><li>We’ll see how to use the <code>state</code> special topic, allowing <strong>the device to communicate to Google Cloud Console informations about its current state</strong>.</li></ul><p>We hope you enjoyed this really long post and that you learnt something! Don’t hesitate to ping me if you have any questions or improvement suggestions…</p>\n\n                        </section>\n                        \n                            <div class=\"sidebar\">\n                                \n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                        <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                                    \n                                \n                            </div>\n                        \n                    </div>\n                    <hr>\n                    \n                        <div class=\"post-full-author-header\" data-test-label=\"author-header-with-bio\">\n                            \n                                \n    \n    \n    \n\n    <section class=\"author-card\" data-test-label=\"author-card\">\n        \n            <span class=\"avatar-wrapper\">\n                \n                <svg role=\"img\" style=\"pointer-events: none;\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" data-test-label=\"avatar\"><title>Olivier LOURME</title><g fill=\"none\" fill-rule=\"evenodd\"><path d=\"M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z\" fill=\"#FFF\"></path></g></svg>\n\n            </span>\n        \n\n        <section class=\"author-card-content \">\n            <span class=\"author-card-name\">\n                <a href=\"/news/author/olivier/\" data-test-label=\"profile-link\">\n                    \n                        Olivier LOURME\n                    \n                </a>\n            </span>\n            \n                \n                    <p data-test-label=\"default-bio\">\n                        Read <a href=\"/news/author/olivier/\">more posts</a>.\n                    </p>\n                \n            \n        </section>\n    </section>\n\n                            \n                        </div>\n                        <hr>\n                    \n\n                    \n                    \n                        \n    \n\n\n<p data-test-label=\"social-row-cta\" class=\"social-row\">\n    If this article was helpful, <button id=\"tweet-btn\" class=\"cta-button\" data-test-label=\"tweet-button\">share it</button>.\n</p>\n\n\n    \n    <script>document.addEventListener(\"DOMContentLoaded\",(()=>{const t=document.getElementById(\"tweet-btn\"),e=window.location,n=\"How%20to%20check%20the%20weather%20using%20GCP-Cloud%20IoT%20Core%20with%20ESP32%20and%20Mongoose%20OS\".replace(/&#39;/g,\"%27\"),o=\"\",i=\"\",r=Boolean(\"\");let h;if(r&&(o||i)){const t={originalPostAuthor:\"\",currentPostAuthor:\"Olivier LOURME\"};h=encodeURIComponent(`Thank you ${o||t.originalPostAuthor} for writing this helpful article, and ${i||t.currentPostAuthor} for translating it.`)}else!r&&i&&(h=encodeURIComponent(`Thank you ${i} for writing this helpful article.`));const c=`window.open(\\n    '${h?`https://twitter.com/intent/tweet?text=${h}%0A%0A${n}%0A%0A${e}`:`https://twitter.com/intent/tweet?text=${n}%0A%0A${e}`}',\\n    'share-twitter',\\n    'width=550, height=235'\\n  ); return false;`;t.setAttribute(\"onclick\",c)}));</script>\n\n\n                        \n\n<div class=\"learn-cta-row\" data-test-label=\"learn-cta-row\">\n    <p>\n        Learn to code for free. freeCodeCamp's open source curriculum has helped more than 40,000 people get jobs as developers. <a href=\"https://www.freecodecamp.org/learn/\" class=\"cta-button\" id=\"learn-to-code-cta\" rel=\"noopener noreferrer\" target=\"_blank\">Get started</a>\n    </p>\n</div>\n\n                    \n                </section>\n                \n                    <div class=\"banner-ad bottom\">\n                        \n                            <div class=\"ad-wrapper\" data-test-label=\"ad-wrapper\">\n    \n    <div class=\"ad-text\" data-test-label=\"ad-text\">ADVERTISEMENT</div>\n    <ins class=\"adsbygoogle\" style=\"display: block; height: 280px;\" data-ad-client=\"ca-pub-9482786369113753\" data-ad-slot=\"5720086888\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins>\n    <script>\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    </script>\n</div>\n\n                        \n                    </div>\n                \n            </article>\n        </div>\n    </main>\n\n\n            \n\n\n<footer class=\"site-footer\">\n    <div class=\"footer-top\">\n        <div class=\"footer-desc-col\">\n            <p data-test-label=\"tax-exempt-status\">freeCodeCamp is a donor-supported tax-exempt 501(c)(3) charity organization (United States Federal Tax Identification Number: 82-0779546)</p>\n            <p data-test-label=\"mission-statement\">Our mission: to help people learn to code for free. We accomplish this by creating thousands of videos, articles, and interactive coding lessons - all freely available to the public.</p>\n            <p data-test-label=\"donation-initiatives\">Donations to freeCodeCamp go toward our education initiatives, and help pay for servers, services, and staff.</p>\n            <p class=\"footer-donation\" data-test-label=\"donate-text\">\n                You can <a href=\"https://www.freecodecamp.org/donate/\" class=\"inline\" rel=\"noopener noreferrer\" target=\"_blank\">make a tax-deductible donation here</a>.\n            </p>\n        </div>\n        <div class=\"trending-guides\" data-test-label=\"trending-guides\">\n            <h2 id=\"trending-guides\" class=\"col-header\">Trending Guides</h2>\n            <ul class=\"trending-guides-articles\" aria-labelledby=\"trending-guides\">\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/complete-guide-to-css-transform-functions-and-properties/\" rel=\"noopener noreferrer\" target=\"_blank\">Learn CSS Transform\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/how-to-create-a-static-blog-with-lume/\" rel=\"noopener noreferrer\" target=\"_blank\">Build a Static Blog\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/how-to-build-an-ai-chatbot-with-redis-python-and-gpt/\" rel=\"noopener noreferrer\" target=\"_blank\">Build an AI Chatbot\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/what-is-programming-tutorial-for-beginners/\" rel=\"noopener noreferrer\" target=\"_blank\">What is Programming?\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/python-code-examples-sample-script-coding-tutorial-for-beginners/\" rel=\"noopener noreferrer\" target=\"_blank\">Python Code Examples\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/a-practical-guide-to-start-opensource-contributions/\" rel=\"noopener noreferrer\" target=\"_blank\">Open Source for Devs\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/http-full-course/\" rel=\"noopener noreferrer\" target=\"_blank\">HTTP Networking in JS\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/how-to-write-unit-tests-in-react-redux/\" rel=\"noopener noreferrer\" target=\"_blank\">Write React Unit Tests\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/introduction-to-algorithms-with-javascript-examples/\" rel=\"noopener noreferrer\" target=\"_blank\">Learn Algorithms in JS\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/how-to-write-clean-code/\" rel=\"noopener noreferrer\" target=\"_blank\">How to Write Clean Code\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/the-php-handbook/\" rel=\"noopener noreferrer\" target=\"_blank\">Learn PHP\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/the-java-handbook/\" rel=\"noopener noreferrer\" target=\"_blank\">Learn Java\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/the-swift-handbook/\" rel=\"noopener noreferrer\" target=\"_blank\">Learn Swift\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/learn-golang-handbook/\" rel=\"noopener noreferrer\" target=\"_blank\">Learn Golang\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/get-started-with-nodejs/\" rel=\"noopener noreferrer\" target=\"_blank\">Learn Node.js\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/complete-guide-to-css-grid/\" rel=\"noopener noreferrer\" target=\"_blank\">Learn CSS Grid\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/learn-solidity-handbook/\" rel=\"noopener noreferrer\" target=\"_blank\">Learn Solidity\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/the-express-handbook/\" rel=\"noopener noreferrer\" target=\"_blank\">Learn Express.js\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/javascript-es-modules-and-module-bundlers/\" rel=\"noopener noreferrer\" target=\"_blank\">Learn JS Modules\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/apache-kafka-handbook/\" rel=\"noopener noreferrer\" target=\"_blank\">Learn Apache Kafka\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/rest-api-design-best-practices-build-a-rest-api/\" rel=\"noopener noreferrer\" target=\"_blank\">REST API Best Practices\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/front-end-javascript-development-react-angular-vue-compared/\" rel=\"noopener noreferrer\" target=\"_blank\">Front-End JS Development\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/build-consume-and-document-a-rest-api/\" rel=\"noopener noreferrer\" target=\"_blank\">Learn to Build REST APIs\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/build-strongly-typed-polymorphic-components-with-react-and-typescript/\" rel=\"noopener noreferrer\" target=\"_blank\">Intermediate TS and React\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/command-line-for-beginners/\" rel=\"noopener noreferrer\" target=\"_blank\">Command Line for Beginners\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/an-introduction-to-operating-systems/\" rel=\"noopener noreferrer\" target=\"_blank\">Intro to Operating Systems\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/building-consuming-and-documenting-a-graphql-api/\" rel=\"noopener noreferrer\" target=\"_blank\">Learn to Build GraphQL APIs\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/oss-security-best-practices/\" rel=\"noopener noreferrer\" target=\"_blank\">OSS Security Best Practices\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/design-patterns-for-distributed-systems/\" rel=\"noopener noreferrer\" target=\"_blank\">Distributed Systems Patterns\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://www.freecodecamp.org/news/an-introduction-to-software-architecture-patterns/\" rel=\"noopener noreferrer\" target=\"_blank\">Software Architecture Patterns\n                    </a>\n                </li>\n            </ul>\n            <div class=\"spacer\" style=\"padding: 15px 0;\"></div>\n            <div>\n                <h2 id=\"mobile-app\" class=\"col-header\">\n                    Mobile App\n                </h2>\n                <div class=\"min-h-[1px] px-[15px] md:w-2/3 md:ml-[16.6%]\">\n                    <ul aria-labelledby=\"mobile-app\" class=\"mobile-app-container\">\n                        <li>\n                            <a href=\"https://apps.apple.com/us/app/freecodecamp/id6446908151?itsct=apps_box_link&itscg=30200\" rel=\"noopener noreferrer\" target=\"_blank\">\n                                <img src=\"https://cdn.freecodecamp.org/platform/universal/apple-store-badge.svg\" lang=\"en\" alt=\"Download on the App Store\">\n                            </a>\n                        </li>\n                        <li>\n                            <a href=\"https://play.google.com/store/apps/details?id=org.freecodecamp\" rel=\"noopener noreferrer\" target=\"_blank\">\n                                <img src=\"https://cdn.freecodecamp.org/platform/universal/google-play-badge.svg\" lang=\"en\" alt=\"Get it on Google Play\">\n                            </a>\n                        </li>\n                    </ul>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class=\"footer-bottom\">\n        <h2 class=\"col-header\" data-test-label=\"our-nonprofit\">Our Charity</h2>\n        <div class=\"our-nonprofit\">\n            <a href=\"https://www.freecodecamp.org/news/about/\" rel=\"noopener noreferrer\" target=\"_blank\" data-test-label=\"about\">\n                About\n            </a>\n            <a href=\"https://www.linkedin.com/school/free-code-camp/people/\" rel=\"noopener noreferrer\" target=\"_blank\" data-test-label=\"alumni\">\n                Alumni Network\n            </a>\n            <a href=\"https://github.com/freeCodeCamp/\" rel=\"noopener noreferrer\" target=\"_blank\" data-test-label=\"open-source\">\n                Open Source\n            </a>\n            <a href=\"https://www.freecodecamp.org/news/shop/\" rel=\"noopener noreferrer\" target=\"_blank\" data-test-label=\"shop\">\n                Shop\n            </a>\n            <a href=\"https://www.freecodecamp.org/news/support/\" rel=\"noopener noreferrer\" target=\"_blank\" data-test-label=\"support\">\n                Support\n            </a>\n            <a href=\"https://www.freecodecamp.org/news/sponsors/\" rel=\"noopener noreferrer\" target=\"_blank\" data-test-label=\"sponsors\">\n                Sponsors\n            </a>\n            <a href=\"https://www.freecodecamp.org/news/academic-honesty-policy/\" rel=\"noopener noreferrer\" target=\"_blank\" data-test-label=\"honesty\">\n                Academic Honesty\n            </a>\n            <a href=\"https://www.freecodecamp.org/news/code-of-conduct/\" rel=\"noopener noreferrer\" target=\"_blank\" data-test-label=\"coc\">\n                Code of Conduct\n            </a>\n            <a href=\"https://www.freecodecamp.org/news/privacy-policy/\" rel=\"noopener noreferrer\" target=\"_blank\" data-test-label=\"privacy\">\n                Privacy Policy\n            </a>\n            <a href=\"https://www.freecodecamp.org/news/terms-of-service/\" rel=\"noopener noreferrer\" target=\"_blank\" data-test-label=\"tos\">\n                Terms of Service\n            </a>\n            <a href=\"https://www.freecodecamp.org/news/copyright-policy/\" rel=\"noopener noreferrer\" target=\"_blank\" data-test-label=\"copyright\">\n                Copyright Policy\n            </a>\n        </div>\n    </div>\n</footer>\n\n        </div>\n\n        \n        \n        \n\n        <!-- Google Tag Manager (noscript) -->\n<noscript><iframe src=\"https://www.googletagmanager.com/ns.html?id=GTM-5D6RKKP\" height=\"0\" width=\"0\" style=\"display:none;visibility:hidden\"></iframe></noscript>\n<!-- End Google Tag Manager (noscript) -->\n\n        \n    <script defer src=\"https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015\" integrity=\"sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==\" data-cf-beacon='{\"rayId\":\"8ac95f2bbfc7ce19\",\"version\":\"2024.7.0\",\"serverTiming\":{\"name\":{\"cfL4\":true}},\"token\":\"bdb993c6dde44e178aabd9555e75e4f4\",\"b\":1}' crossorigin=\"anonymous\"></script>\n</body>\n</html>\n"}}}